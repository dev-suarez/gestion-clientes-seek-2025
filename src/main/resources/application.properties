# =====================================================
# Configuración del Microservicio de Gestión de Clientes
# =====================================================
# Este archivo contiene toda la configuración necesaria
# para el funcionamiento del microservicio incluyendo
# base de datos, seguridad, logging y documentación.
# =====================================================

# Configuración del servidor
server.port=8080
server.servlet.context-path=/
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on-param

# Configuración de Spring
spring.application.name=clientes
spring.profiles.active=development

# Configuración de base de datos
spring.datasource.url=jdbc:mysql://localhost:3306/client_management?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Pool de conexiones HikariCP
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.pool-name=ClientManagementHikariCP
spring.datasource.hikari.leak-detection-threshold=60000

# Configuración JPA/Hibernate
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
spring.jpa.hibernate.naming.implicit-strategy=org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Configuración de Flyway
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.table=flyway_schema_history
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true

# Configuración de seguridad
spring.security.user.name=admin
spring.security.user.password=admin123
spring.security.user.roles=ADMIN

# Configuración JWT personalizada
app.jwt.secret=mySecretKeyForJWTTokenGenerationThatShouldBeChangedInProduction
app.jwt.expiration=86400000

# Configuración de logging
logging.level.com.desafio.clientes=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.flywaydb=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/clientes.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# Configuración de Actuator para monitoreo
management.endpoints.web.exposure.include=health,info,metrics,env,beans,flyway
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=when_authorized
management.endpoint.health.show-components=always
management.info.env.enabled=true
management.info.java.enabled=true
management.info.os.enabled=true

# Información de la aplicación
info.app.name=@project.name@
info.app.description=Microservicio de gestión de clientes
info.app.version=@project.version@
info.app.java.version=@java.version@

# Configuración de documentación API (Swagger/OpenAPI)
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha
springdoc.show-actuator=true

# =====================================================
# Configuración para entorno de DESARROLLO
# =====================================================
# Estas propiedades se activan cuando el perfil 'development' está activo

# Base de datos en desarrollo
%dev.spring.datasource.url=jdbc:mysql://localhost:3306/client_management?useSSL=false&serverTimezone=UTC
%dev.spring.datasource.username=root
%dev.spring.datasource.password=root

# Configuración JPA para desarrollo
%dev.spring.jpa.show-sql=true
%dev.spring.jpa.hibernate.ddl-auto=validate

# Logging más detallado en desarrollo
%dev.logging.level.com.desafio.clientes=TRACE
%dev.logging.level.org.springframework.web=DEBUG
%dev.logging.level.org.springframework.security=DEBUG

# JWT con expiración más corta para desarrollo
%dev.app.jwt.expiration=3600000

# =====================================================
# Configuración para entorno de TESTING
# =====================================================
# Estas propiedades se activan cuando el perfil 'test' está activo

# Base de datos en memoria para tests
%test.spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
%test.spring.datasource.username=sa
%test.spring.datasource.password=
%test.spring.datasource.driver-class-name=org.h2.Driver

# Configuración JPA para tests
%test.spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
%test.spring.jpa.hibernate.ddl-auto=create-drop
%test.spring.jpa.show-sql=false

# Flyway deshabilitado en tests
%test.spring.flyway.enabled=false

# Logging mínimo en tests
%test.logging.level.com.desafio.clientes=WARN
%test.logging.level.org.springframework=WARN
%test.logging.level.org.hibernate=WARN

# =====================================================
# Configuración para entorno de PRODUCCIÓN
# =====================================================
# Estas propiedades se activan cuando el perfil 'production' está activo

# Base de datos de producción (usar variables de entorno)
%prod.spring.datasource.url=${DB_URL:jdbc:mysql://prod-db:3306/client_management}
%prod.spring.datasource.username=${DB_USERNAME:prod_user}
%prod.spring.datasource.password=${DB_PASSWORD:prod_password}

# Pool de conexiones optimizado para producción
%prod.spring.datasource.hikari.maximum-pool-size=50
%prod.spring.datasource.hikari.minimum-idle=10
%prod.spring.datasource.hikari.idle-timeout=600000
%prod.spring.datasource.hikari.max-lifetime=1800000

# Configuración JPA para producción
%prod.spring.jpa.show-sql=false
%prod.spring.jpa.hibernate.ddl-auto=validate

# JWT seguro para producción
%prod.app.jwt.secret=${JWT_SECRET:changeThisSecretInProduction}
%prod.app.jwt.expiration=${JWT_EXPIRATION:86400000}

# Logging para producción
%prod.logging.level.com.desafio.clientes=INFO
%prod.logging.level.org.springframework=WARN
%prod.logging.level.org.hibernate=WARN
%prod.logging.file.name=/var/log/clientes/app.log

# Actuator con seguridad en producción
%prod.management.endpoints.web.exposure.include=health,info,metrics
%prod.management.endpoint.health.show-details=never